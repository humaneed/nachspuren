<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
  <title>Tafel-ABC Nachspuren ¬∑ Druckschrift</title>
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #dbeafe 0, #93c5fd 40%, #1e293b 100%);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }
    .shell {
      width: 100%;
      max-width: 520px;
      padding: 12px;
      display: flex;
      align-items: stretch;
    }
    .board {
      background: #14432b; /* Tafel-Gr√ºn */
      border-radius: 24px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.4);
      color: #f9fafb;
      padding: 10px 12px 12px;
      width: 100%;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }
    .board::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(transparent 0, transparent 6%, rgba(15,23,42,0.2) 6.2%, transparent 6.4%),
        radial-gradient(circle at top left, rgba(255,255,255,0.08), transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }
    .board-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .board-header {
      display: flex;
      flex-direction: column;
      gap: 2px;
      padding: 2px 2px 4px;
    }
    .title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }
    .board-title {
      font-size: 1.2rem;
      font-weight: 700;
      letter-spacing: 0.03em;
    }
    .board-subtitle {
      font-size: 0.7rem;
      opacity: 0.8;
      text-align: right;
    }

    .abc-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-top: 2px;
    }
    .current-letter-label {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 0.06em;
      white-space: nowrap;
    }
    .mode-toggle {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid rgba(226,232,240,0.4);
      overflow: hidden;
      font-size: 0.7rem;
    }
    .mode-btn {
      border: none;
      padding: 4px 8px;
      background: transparent;
      color: #e5e7eb;
      cursor: pointer;
      font-weight: 500;
      opacity: 0.7;
    }
    .mode-btn.active {
      background: rgba(15,23,42,0.5);
      opacity: 1;
    }

    .controls-row {
      display: flex;
      gap: 6px;
      align-items: center;
      margin-top: 4px;
      flex-wrap: wrap;
    }
    .pill-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.8;
    }
    .select {
      padding: 4px 6px;
      font-size: 0.78rem;
      border-radius: 999px;
      border: 1px solid rgba(226,232,240,0.55);
      background: rgba(15,23,42,0.25);
      color: #e5e7eb;
    }

    .color-row {
      display: flex;
      gap: 6px;
      align-items: center;
      margin-top: 4px;
      flex-wrap: wrap;
    }
    .color-dot {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 2px solid transparent;
      cursor: pointer;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.4);
    }
    .color-dot.active {
      border-color: #f9fafb;
      box-shadow: 0 0 0 2px rgba(249,250,251,0.7);
    }

    .canvas-wrap {
      position: relative;
      border-radius: 18px;
      border: 2px solid rgba(226,232,240,0.35);
      background: rgba(15,23,42,0.15);
      overflow: hidden;
      margin-top: 6px;
    }
    #traceCanvas {
      display: block;
      width: 100%;
      touch-action: none;
      background: transparent;
    }

    .buttons-row {
      display: flex;
      gap: 6px;
      margin-top: 6px;
      flex-wrap: wrap;
    }
    .btn {
      flex: 1 1 0;
      min-width: 0;
      border-radius: 999px;
      border: none;
      padding: 7px 10px;
      font-size: 0.78rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      background: rgba(15,23,42,0.35);
      color: #e5e7eb;
      box-shadow: 0 2px 4px rgba(0,0,0,0.4);
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    .btn-accent {
      background: #f97316;
      color: #111827;
    }

    .hint-row {
      margin-top: 4px;
      font-size: 0.7rem;
      opacity: 0.9;
    }
    .hint-strong {
      font-weight: 600;
    }

    @media (min-width: 540px) {
      .board-title { font-size: 1.3rem; }
    }

    @media (max-width: 420px) {
      .shell { padding: 8px; }
      .board { border-radius: 18px; padding: 8px 9px 10px; }
      .board-title { font-size: 1.15rem; }
      .current-letter-label { font-size: 1.4rem; }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="board">
      <div class="board-inner">
        <header class="board-header">
          <div class="title-row">
            <div class="board-title">Mein Tafel-ABC</div>
            <div class="board-subtitle">Druckschrift ¬∑ Nachspuren</div>
          </div>
          <div class="abc-row">
            <div id="currentPair" class="current-letter-label">A a</div>
            <div class="mode-toggle">
              <button class="mode-btn active" data-mode="upper">ABC</button>
              <button class="mode-btn" data-mode="lower">abc</button>
              <button class="mode-btn" data-mode="digits">123</button>
            </div>
          </div>
        </header>

        <div class="controls-row">
          <span class="pill-label">Zeichen</span>
          <select id="charSelect" class="select"></select>
        </div>

        <div class="color-row">
          <span class="pill-label">Kreide</span>
          <button class="color-dot" data-color="#facc15" style="background:#facc15;"></button>
          <button class="color-dot active" data-color="#e5e7eb" style="background:#e5e7eb;"></button>
          <button class="color-dot" data-color="#38bdf8" style="background:#38bdf8;"></button>
          <button class="color-dot" data-color="#f97316" style="background:#f97316;"></button>
          <button class="color-dot" data-color="#22c55e" style="background:#22c55e;"></button>
          <button class="color-dot" data-color="#fb7185" style="background:#fb7185;"></button>
        </div>

        <div class="canvas-wrap">
          <canvas id="traceCanvas" width="600" height="320"></canvas>
        </div>

        <div class="buttons-row">
          <button id="btnPrev" class="btn">‚¨ÖÔ∏è Zur√ºck</button>
          <button id="btnRandom" class="btn btn-accent">üé≤ Zufall</button>
          <button id="btnNext" class="btn">Weiter ‚û°Ô∏è</button>
        </div>
        <div class="buttons-row">
          <button id="btnClear" class="btn">üßΩ Tafel wischen</button>
          <button id="btnToggleGuide" class="btn">üëÅ Vorlage aus</button>
        </div>

        <div class="hint-row">
          <div id="exampleHint" class="hint-strong"></div>
          <div id="tipHint"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Alphabet (deutsches Druckschrift-ABC + √ü)
    const UPPER = "A√ÑBCDEFGHIJKLMNO√ñPQRSTUVW√úXYZ".split("");
    const LOWER = "a√§bcdefghijklmno√∂pqrstuvw√ºxyz√ü".split("");
    const DIGITS = "0123456789".split("");

    const LETTER_EXAMPLES = {
      A: "A wie Apfel",
      B: "B wie Ball",
      C: "C wie Clown",
      D: "D wie Dino",
      E: "E wie Ente",
      F: "F wie Fisch",
      G: "G wie Giraffe",
      H: "H wie Haus",
      I: "I wie Igel",
      J: "J wie Junge",
      K: "K wie Katze",
      L: "L wie L√∂we",
      M: "M wie Maus",
      N: "N wie Nase",
      O: "O wie Ohr",
      P: "P wie Pirat",
      Q: "Q wie Qualle",
      R: "R wie Regen",
      S: "S wie Sonne",
      T: "T wie Tiger",
      U: "U wie Uhr",
      V: "V wie Vogel",
      W: "W wie Wald",
      X: "X wie Xylofon",
      Y: "Y wie Yoga",
      Z: "Z wie Zebra"
    };

    const DIGIT_EXAMPLES = {
      0: "0 ‚Äì Ein runder Kreis.",
      1: "1 ‚Äì Ein Strich, ein Finger.",
      2: "2 ‚Äì Zwei Augen, zwei Schuhe.",
      3: "3 ‚Äì Drei Schritte.",
      4: "4 ‚Äì Vier R√§der am Auto.",
      5: "5 ‚Äì F√ºnf Finger an der Hand.",
      6: "6 ‚Äì Sechs Bausteine.",
      7: "7 ‚Äì Sieben Wochentage.",
      8: "8 ‚Äì Wie ein Schneemann.",
      9: "9 ‚Äì Viele Punkte."
    };

    const modeButtons = Array.from(document.querySelectorAll(".mode-btn"));
    const charSelect = document.getElementById("charSelect");
    const currentPair = document.getElementById("currentPair");
    const canvas = document.getElementById("traceCanvas");
    const ctx = canvas.getContext("2d");
    const btnPrev = document.getElementById("btnPrev");
    const btnNext = document.getElementById("btnNext");
    const btnRandom = document.getElementById("btnRandom");
    const btnClear = document.getElementById("btnClear");
    const btnToggleGuide = document.getElementById("btnToggleGuide");
    const colorDots = Array.from(document.querySelectorAll(".color-dot"));
    const exampleHint = document.getElementById("exampleHint");
    const tipHint = document.getElementById("tipHint");

    let mode = "upper";
    let list = UPPER;
    let index = 0;
    let currentChar = "A";
    let penColor = "#e5e7eb";
    let drawing = false;
    let lastX = 0;
    let lastY = 0;
    let showGuide = true;

    // --- Modus & Zeichenwahl ---
    function setMode(newMode) {
      mode = newMode;
      if (mode === "upper") list = UPPER;
      else if (mode === "lower") list = LOWER;
      else list = DIGITS;

      modeButtons.forEach(btn => {
        btn.classList.toggle("active", btn.dataset.mode === mode);
      });

      fillCharSelect();
      setCharByIndex(0);
    }

    function fillCharSelect() {
      charSelect.innerHTML = "";
      list.forEach((ch, i) => {
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = ch;
        charSelect.appendChild(opt);
      });
    }

    function setCharByIndex(i) {
      if (!list.length) return;
      if (i < 0) i = list.length - 1;
      if (i >= list.length) i = 0;
      index = i;
      currentChar = list[index];
      charSelect.value = String(index);

      const up = currentChar.toUpperCase();
      const low = currentChar.toLowerCase();

      if (mode === "upper") {
        currentPair.textContent = up + " " + low;
      } else if (mode === "lower") {
        currentPair.textContent = up + " " + low;
      } else {
        currentPair.textContent = currentChar;
      }

      updateHints();
      clearCanvas();
    }

    function updateHints() {
      if (mode === "digits") {
        exampleHint.textContent = DIGIT_EXAMPLES[currentChar] || ("Zahl " + currentChar + " schreiben √ºben.");
        tipHint.textContent = "Sag die Zahl laut und spure sie langsam nach. Suche dann passende Dinge im Raum.";
      } else {
        const upper = currentChar.toUpperCase();
        const base = LETTER_EXAMPLES[upper] || (upper + " schreiben √ºben.");
        exampleHint.textContent = base;
        tipHint.textContent = "Sprich den Buchstaben laut und spure ihn langsam nach ‚Äì zuerst gro√ü, dann klein.";
      }
    }

    // --- Tafel-Linien + Leitbuchstabe im Canvas ---
    function resizeCanvas() {
      const rect = canvas.getBoundingClientRect();
      const ratio = window.devicePixelRatio || 1;
      const targetHeightCss = rect.width * (16 / 9); // 9:16 Hochformat
      canvas.width = rect.width * ratio;
      canvas.height = targetHeightCss * ratio;
      canvas.style.height = targetHeightCss + "px";
      ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
      clearCanvas();
    }

    function clearCanvas() {
      const w = canvas.clientWidth || canvas.width;
      const h = canvas.clientHeight || canvas.height;
      ctx.clearRect(0, 0, w, h);
      drawGuidelinesAndLetter();
    }

    function drawGuidelinesAndLetter() {
      const w = canvas.clientWidth || canvas.width;
      const h = canvas.clientHeight || canvas.height;
      if (!w || !h) return;

      // 4-Linien-System wie auf dem Poster
      ctx.save();
      ctx.lineWidth = 1;
      ctx.strokeStyle = "rgba(226,232,240,0.55)";

      const blockHeight = h * 0.32;
      const top = (h - blockHeight) / 2;
      const step = blockHeight / 3;

      const y0 = top;            // Oberlinie
      const y1 = top + step;     // Mittellinie
      const y2 = top + 2*step;   // Grundlinie
      const y3 = top + 3*step;   // Unterl√§nge

      const xs = { left: w*0.06, right: w*0.94 };

      [y0, y1, y2, y3].forEach((y, i) => {
        ctx.beginPath();
        ctx.setLineDash(i === 0 || i === 3 ? [] : [8,5]);
        ctx.moveTo(xs.left, y);
        ctx.lineTo(xs.right, y);
        ctx.stroke();
      });

      // Randlinie links
      ctx.setLineDash([4,6]);
      ctx.beginPath();
      ctx.moveTo(w*0.1, y0 - step*0.4);
      ctx.lineTo(w*0.1, y3 + step*0.4);
      ctx.stroke();
      ctx.restore();

      if (!showGuide || !currentChar) return;

      // Leitbuchstabe auf den Linien
      ctx.save();
      const isDigit = mode === "digits";
      const up = currentChar.toUpperCase();
      const drawChar = isDigit ? currentChar : (mode === "lower" ? currentChar.toLowerCase() : up);

      // Font grob an Distanz Oberlinie‚ÄìGrundlinie anpassen
      const capHeight = y2 - y0;
      const fontSize = capHeight * 1.44; // etwas Luft oben/unten
      ctx.font = fontSize.toFixed(0) + 'px "Trebuchet MS", system-ui, sans-serif';
      ctx.textAlign = "center";
      ctx.textBaseline = "alphabetic";
      ctx.fillStyle = "rgba(248,250,252,0.9)";
      ctx.globalAlpha = 0.38;

      // Grundlinie leicht √ºber y2, damit Unterl√§ngen bis y3 laufen k√∂nnen
      const baseline = y2 - step * 0.08;
      const x = w * 0.52;

      ctx.fillText(drawChar, x, baseline);
      ctx.restore();
    }

    // --- Zeichnen mit ‚ÄûKreide‚Äú ---
    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      if (e.touches && e.touches[0]) {
        return {
          x: e.touches[0].clientX - rect.left,
          y: e.touches[0].clientY - rect.top
        };
      }
      return {
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
      };
    }

    function startDraw(e) {
      e.preventDefault();
      const pos = getPos(e);
      drawing = true;
      lastX = pos.x;
      lastY = pos.y;
    }

    function moveDraw(e) {
      if (!drawing) return;
      e.preventDefault();
      const pos = getPos(e);
      const width = canvas.clientWidth || 300;
      const base = 0.05; // Kreide-Dicke
      ctx.lineWidth = Math.max(width * base, 5);
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.strokeStyle = penColor;
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
      lastX = pos.x;
      lastY = pos.y;
    }

    function endDraw(e) {
      if (!drawing) return;
      e.preventDefault();
      drawing = false;
    }

    canvas.addEventListener("mousedown", startDraw);
    canvas.addEventListener("mousemove", moveDraw);
    window.addEventListener("mouseup", endDraw);

    canvas.addEventListener("touchstart", startDraw, { passive: false });
    canvas.addEventListener("touchmove", moveDraw, { passive: false });
    canvas.addEventListener("touchend", endDraw, { passive: false });
    canvas.addEventListener("touchcancel", endDraw, { passive: false });

    // --- UI-Events ---
    colorDots.forEach(dot => {
      dot.addEventListener("click", () => {
        colorDots.forEach(d => d.classList.remove("active"));
        dot.classList.add("active");
        penColor = dot.dataset.color;
      });
    });

    btnPrev.addEventListener("click", () => setCharByIndex(index - 1));
    btnNext.addEventListener("click", () => setCharByIndex(index + 1));
    btnRandom.addEventListener("click", () => {
      const rnd = Math.floor(Math.random() * list.length);
      setCharByIndex(rnd);
    });
    btnClear.addEventListener("click", clearCanvas);

    btnToggleGuide.addEventListener("click", () => {
      showGuide = !showGuide;
      btnToggleGuide.textContent = showGuide ? "üëÅ Vorlage aus" : "üëÅ Vorlage an";
      clearCanvas();
    });

    charSelect.addEventListener("change", () => {
      const i = parseInt(charSelect.value, 10) || 0;
      setCharByIndex(i);
    });

    modeButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        setMode(btn.dataset.mode);
      });
    });

    window.addEventListener("resize", resizeCanvas);
    window.addEventListener("orientationchange", () => setTimeout(resizeCanvas, 150));

    // Start
    function init() {
      setMode("upper");
      fillCharSelect();
      setCharByIndex(0);
      resizeCanvas();
    }
    init();
  </script>
</body>
</html>
