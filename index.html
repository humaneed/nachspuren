<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>KidsNeed ¬∑ Nachspuren üñçÔ∏è</title>
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(to bottom, #e8f4f8 0%, #d4e9f2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .shell {
      max-width: 640px;
      width: 100%;
    }
    .card {
      background: #ffffff;
      border-radius: 24px;
      padding: 20px 18px 18px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, rgba(107,163,212,0.18), rgba(123,200,164,0.18));
      opacity: 0.3;
      pointer-events: none;
    }
    .card-inner {
      position: relative;
      z-index: 1;
    }
    .header {
      text-align: center;
      margin-bottom: 16px;
    }
    .title {
      margin: 0 0 4px;
      font-size: 1.6rem;
      font-weight: 700;
      color: #1f2933;
    }
    .subtitle {
      margin: 0;
      font-size: 0.9rem;
      color: #64748b;
    }

    .controls-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 10px;
      justify-content: center;
    }

    .mode-select,
    .char-select,
    .level-select {
      padding: 6px 10px;
      font-size: 0.95rem;
      border-radius: 999px;
      border: 1px solid #cbd5e1;
      background: #f8fafc;
      color: #1e293b;
    }

    .pill-label {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      color: #64748b;
    }

    .color-row {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .color-dot {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 2px solid transparent;
      cursor: pointer;
      box-shadow: 0 1px 4px rgba(15,23,42,0.2);
    }
    .color-dot.active {
      border-color: #0f172a;
      box-shadow: 0 0 0 3px rgba(15,23,42,0.2);
    }

    .canvas-wrap {
      position: relative;
      margin-top: 8px;
      border-radius: 18px;
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      overflow: hidden;
    }
    #traceCanvas {
      display: block;
      width: 100%;
      touch-action: none;
    }
    .guide-char {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      color: rgba(148,163,184,0.45);
      font-weight: 700;
      font-size: 7rem;
      user-select: none;
      transition: opacity 0.25s ease;
    }

    .buttons-row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .btn {
      flex: 1 1 0;
      min-width: 0;
      border-radius: 999px;
      border: none;
      padding: 10px 14px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow: 0 2px 8px rgba(15,23,42,0.15);
    }
    .btn-primary {
      background: #6ba3d4;
      color: #f9fafb;
    }
    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 1px 4px rgba(15,23,42,0.2);
    }
    .btn-ghost {
      background: #e2e8f0;
      color: #0f172a;
    }
    .btn-ghost:active {
      transform: translateY(1px);
      box-shadow: 0 1px 4px rgba(15,23,42,0.18);
    }

    .hint {
      margin-top: 6px;
      font-size: 0.8rem;
      color: #64748b;
      text-align: center;
    }
    .hint-strong {
      font-weight: 600;
      color: #475569;
    }

    @media (min-width: 540px) {
      .title { font-size: 1.8rem; }
      .guide-char { font-size: 8rem; }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="card">
      <div class="card-inner">
        <header class="header">
          <h1 class="title">Nachspuren üñçÔ∏è</h1>
          <p class="subtitle">Gro√ü- & Kleinbuchstaben und Zahlen nachspuren ¬∑ 3‚Äì8 Jahre</p>
        </header>

        <div class="controls-row">
          <span class="pill-label">Modus</span>
          <select id="modeSelect" class="mode-select">
            <option value="upper">Gro√übuchstaben A‚ÄìZ</option>
            <option value="lower">Kleinbuchstaben a‚Äìz</option>
            <option value="digits">Zahlen 0‚Äì9</option>
          </select>

          <span class="pill-label">Zeichen</span>
          <select id="charSelect" class="char-select"></select>
        </div>

        <div class="controls-row">
          <span class="pill-label">Level</span>
          <select id="levelSelect" class="level-select">
            <option value="1">Level 1 ¬∑ 3‚Äì5 Jahre</option>
            <option value="2">Level 2 ¬∑ 5‚Äì7 Jahre</option>
            <option value="3">Level 3 ¬∑ 7‚Äì8 Jahre</option>
          </select>
        </div>

        <p id="lineaturLabel" class="hint"></p>

        <div class="color-row">
          <span class="pill-label">Stiftfarbe</span>
          <button class="color-dot" data-color="#ef4444" style="background:#ef4444;"></button>
          <button class="color-dot" data-color="#f97316" style="background:#f97316;"></button>
          <button class="color-dot" data-color="#eab308" style="background:#eab308;"></button>
          <button class="color-dot" data-color="#22c55e" style="background:#22c55e;"></button>
          <button class="color-dot active" data-color="#0ea5e9" style="background:#0ea5e9;"></button>
          <button class="color-dot" data-color="#6366f1" style="background:#6366f1;"></button>
          <button class="color-dot" data-color="#ec4899" style="background:#ec4899;"></button>
          <button class="color-dot" data-color="#111827" style="background:#111827;"></button>
        </div>

        <div class="canvas-wrap">
          <div id="guideChar" class="guide-char">A</div>
          <canvas id="traceCanvas" width="600" height="320"></canvas>
        </div>

        <div class="buttons-row">
          <button id="btnClear" class="btn btn-ghost">üßΩ L√∂schen</button>
          <button id="btnRandom" class="btn btn-primary">üé≤ Zuf√§lliges Zeichen</button>
          <button id="btnToggleGuide" class="btn btn-ghost">üëÅ Vorlage aus</button>
        </div>

        <p id="exampleHint" class="hint hint-strong"></p>
        <p id="didacticHint" class="hint"></p>
        <p class="hint">
          Tipp: Mit einem Finger oder Stift direkt auf dem Zeichen nachfahren. Auf gr√∂√üeren Bildschirmen
          kann die Maus verwendet werden.
        </p>
      </div>
    </div>
  </div>

  <script>
    // --- Zeichen-Listen ---
    const UPPER = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
    const LOWER = "abcdefghijklmnopqrstuvwxyz".split("");
    const DIGITS = "0123456789".split("");

    // Einfache Merks√§tze f√ºr Buchstaben (A‚ÄìZ)
    const LETTER_EXAMPLES = {
      A: "A wie Apfel",
      B: "B wie Ball",
      C: "C wie Clown",
      D: "D wie Dino",
      E: "E wie Ente",
      F: "F wie Fisch",
      G: "G wie Giraffe",
      H: "H wie Haus",
      I: "I wie Igel",
      J: "J wie Junge",
      K: "K wie Katze",
      L: "L wie L√∂we",
      M: "M wie Maus",
      N: "N wie Nase",
      O: "O wie Ohr",
      P: "P wie Pirat",
      Q: "Q wie Qualle",
      R: "R wie Regen",
      S: "S wie Sonne",
      T: "T wie Tiger",
      U: "U wie Uhr",
      V: "V wie Vogel",
      W: "W wie Wald",
      X: "X wie Xylofon",
      Y: "Y wie Yoga",
      Z: "Z wie Zebra"
    };

    // Merks√§tze f√ºr Zahlen (0‚Äì9)
    const DIGIT_EXAMPLES = {
      0: "0 ‚Äì Gar nichts, ein leerer Kreis.",
      1: "1 ‚Äì Ein Strich, eine Nase, ein Finger.",
      2: "2 ‚Äì Zwei Augen, zwei Schuhe.",
      3: "3 ‚Äì Drei Schritte nach vorn.",
      4: "4 ‚Äì Vier R√§der am Auto.",
      5: "5 ‚Äì F√ºnf Finger an der Hand.",
      6: "6 ‚Äì Sechs bunte Bausteine.",
      7: "7 ‚Äì Sieben Wochentage.",
      8: "8 ‚Äì Wie eine Schneemannfigur.",
      9: "9 ‚Äì Neun Punkte, fast schon ganz viel."
    };

    const modeSelect = document.getElementById("modeSelect");
    const charSelect = document.getElementById("charSelect");
    const levelSelect = document.getElementById("levelSelect");
    const guideChar = document.getElementById("guideChar");
    const canvas = document.getElementById("traceCanvas");
    const ctx = canvas.getContext("2d");
    const btnClear = document.getElementById("btnClear");
    const btnRandom = document.getElementById("btnRandom");
    const btnToggleGuide = document.getElementById("btnToggleGuide");
    const colorDots = Array.from(document.querySelectorAll(".color-dot"));
    const exampleHint = document.getElementById("exampleHint");
    const didacticHint = document.getElementById("didacticHint");
    const lineaturLabel = document.getElementById("lineaturLabel");

    let currentList = UPPER;
    let penColor = "#0ea5e9";
    let drawing = false;
    let lastX = 0;
    let lastY = 0;
    let guideVisible = true;

    // --- Helfer: Canvas-Gr√∂√üe an Container anpassen ---
    function resizeCanvas() {
      const rect = canvas.getBoundingClientRect();
      const ratio = window.devicePixelRatio || 1;
      canvas.width = rect.width * ratio;
      canvas.height = rect.width * 0.55 * ratio; // Seitenverh√§ltnis
      canvas.style.height = (rect.width * 0.55) + "px";
      ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
      clearCanvas();
    }

    function clearCanvas() {
      const w = canvas.clientWidth;
      const h = canvas.clientHeight;
      ctx.fillStyle = "#f8fafc";
      ctx.fillRect(0, 0, w, h);
      drawLineatur();
    }

    // einfache Anlehnung an Grundschul-Heftlineaturen (DIN 16552-1)
    function drawLineatur() {
      const level = levelSelect.value; // "1", "2" oder "3"
      const w = canvas.clientWidth;
      const h = canvas.clientHeight;
      if (!w || !h) return;

      ctx.save();
      ctx.lineWidth = 1;
      const strong = "#cbd5e1";   // Hauptlinien (Schreiblinie / Oberlinie)
      const soft = "#e5e7eb";     // Hilfslinien

      // zentrales Liniensystem, wie bei einem Heft
      if (level === "1") {
        // Angelehnt an Lineatur 1: vier Linien, gro√üe Abst√§nde
        const blockHeight = h * 0.32;
        const top = (h - blockHeight) / 2;
        const step = blockHeight / 3;
        const ys = [top, top + step, top + 2 * step, top + 3 * step];

        ys.forEach((y, index) => {
          ctx.beginPath();
          ctx.setLineDash(index === 0 || index === 3 ? [] : [6, 4]);
          ctx.strokeStyle = index === 0 || index === 3 ? strong : soft;
          ctx.moveTo(w * 0.08, y);
          ctx.lineTo(w * 0.98, y);
          ctx.stroke();
        });

        // linker Rand zur Orientierung
        ctx.beginPath();
        ctx.setLineDash([4, 6]);
        ctx.strokeStyle = soft;
        ctx.moveTo(w * 0.08, top - step * 0.5);
        ctx.lineTo(w * 0.08, top + blockHeight + step * 0.5);
        ctx.stroke();
      } else if (level === "2") {
        // Angelehnt an Lineatur 2: vier Linien, etwas enger
        const blockHeight = h * 0.26;
        const top = (h - blockHeight) / 2;
        const step = blockHeight / 3;
        const ys = [top, top + step, top + 2 * step, top + 3 * step];

        ys.forEach((y, index) => {
          ctx.beginPath();
          ctx.setLineDash(index === 0 || index === 3 ? [] : [5, 4]);
          ctx.strokeStyle = index === 0 || index === 3 ? strong : soft;
          ctx.moveTo(w * 0.08, y);
          ctx.lineTo(w * 0.98, y);
          ctx.stroke();
        });

        ctx.beginPath();
        ctx.setLineDash([4, 6]);
        ctx.strokeStyle = soft;
        ctx.moveTo(w * 0.08, top - step * 0.5);
        ctx.lineTo(w * 0.08, top + blockHeight + step * 0.5);
        ctx.stroke();
      } else {
        // Angelehnt an Lineatur 3 / 4: zwei Linien (Schreiblinie + Oberlinie)
        const blockHeight = h * 0.22;
        const top = (h - blockHeight) / 2;
        const bottom = top + blockHeight;

        // Schreiblinie (unten) kr√§ftiger
        ctx.beginPath();
        ctx.setLineDash([]);
        ctx.strokeStyle = strong;
        ctx.moveTo(w * 0.08, bottom);
        ctx.lineTo(w * 0.98, bottom);
        ctx.stroke();

        // Oberlinie (x-H√∂he)
        ctx.beginPath();
        ctx.setLineDash([6, 4]);
        ctx.strokeStyle = soft;
        ctx.moveTo(w * 0.08, top);
        ctx.lineTo(w * 0.98, top);
        ctx.stroke();

        // optionaler Rand
        ctx.beginPath();
        ctx.setLineDash([4, 6]);
        ctx.strokeStyle = soft;
        ctx.moveTo(w * 0.08, top - blockHeight * 0.4);
        ctx.lineTo(w * 0.08, bottom + blockHeight * 0.4);
        ctx.stroke();
      }

      ctx.restore();
    }

    function applyGuideVisibility() {
      guideChar.style.opacity = guideVisible ? 0.45 : 0;
    }

    // --- Zeichenliste je nach Modus ---
    function updateCharList() {
      const mode = modeSelect.value;
      if (mode === "upper") currentList = UPPER;
      else if (mode === "lower") currentList = LOWER;
      else currentList = DIGITS;

      charSelect.innerHTML = "";
      currentList.forEach(ch => {
        const opt = document.createElement("option");
        opt.value = ch;
        opt.textContent = ch;
        charSelect.appendChild(opt);
      });
      charSelect.selectedIndex = 0;
      updateGuideChar();
      updateHints();
    }

    function updateGuideChar() {
      const ch = charSelect.value || currentList[0];
      guideChar.textContent = ch;
      clearCanvas();
      updateHints();
    }

    function updateHints() {
      const mode = modeSelect.value;
      const ch = charSelect.value || currentList[0];
      const level = levelSelect.value;

      // Beispiel-Merksatz
      if (mode === "digits") {
        exampleHint.textContent = DIGIT_EXAMPLES[ch] || "";
      } else {
        const upper = ch.toUpperCase();
        const base = LETTER_EXAMPLES[upper] || "";
        const display = base.replace(/^([A-Z])/, level === "1" ? ch : upper);
        exampleHint.textContent = display;
      }

      // Didaktik-Hinweis je nach Level und Modus
      let text = "";
      if (mode === "digits") {
        if (level === "1") {
          text = "Level 1: Z√§hle die Zahl mit ‚Äì sprich sie laut und spure langsam nach.";
        } else if (level === "2") {
          text = "Level 2: Spure die Zahl zwei- bis dreimal nach und z√§hle passende Dinge im Raum.";
        } else {
          text = "Level 3: Blende bei Bedarf die Vorlage aus und schreibe die Zahl frei aus dem Kopf.";
        }
      } else {
        if (level === "1") {
          text = "Level 1: Sprich den Buchstaben laut, fahre die Form langsam nach und achte auf ruhige Handbewegungen.";
        } else if (level === "2") {
          text = "Level 2: Versuche, den Buchstaben zwei- bis dreimal hintereinander sauber nachzuspuren.";
        } else {
          text = "Level 3: Blende die Vorlage aus und versuche, den Buchstaben frei zu schreiben. Danach kannst du vergleichen.";
        }
      }
      didacticHint.textContent = text;

      // Lineatur-Label passend zum Level
      let label = "";
      if (level === "1") {
        label = "Angelehnt an Grundschul-Lineatur 1 (gro√üe Schreibhilfe, ca. Klasse 1).";
      } else if (level === "2") {
        label = "Angelehnt an Grundschul-Lineatur 2 (vier Linien, ca. Klasse 1‚Äì2).";
      } else {
        label = "Angelehnt an Grundschul-Lineatur 3/4 (zwei Linien, ca. Klasse 3‚Äì4).";
      }
      lineaturLabel.textContent = label;

      // F√ºr Level 1 die Vorlage etwas kr√§ftiger, f√ºr Level 3 dezenter
      if (!guideVisible) return; // manuelle Deaktivierung bleibt bestehen
      if (level === "1") {
        guideChar.style.opacity = 0.5;
      } else if (level === "2") {
        guideChar.style.opacity = 0.42;
      } else {
        guideChar.style.opacity = 0.3;
      }
    }

    // --- Farbauswahl ---
    colorDots.forEach(dot => {
      dot.addEventListener("click", () => {
        colorDots.forEach(d => d.classList.remove("active"));
        dot.classList.add("active");
        penColor = dot.dataset.color;
      });
    });

    // --- Zeichnen (Touch & Maus) ---
    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      if (e.touches && e.touches[0]) {
        return {
          x: e.touches[0].clientX - rect.left,
          y: e.touches[0].clientY - rect.top
        };
      } else {
        return {
          x: e.clientX - rect.left,
          y: e.clientY - rect.top
        };
      }
    }

    function startDraw(e) {
      e.preventDefault();
      const pos = getPos(e);
      drawing = true;
      lastX = pos.x;
      lastY = pos.y;
    }

    function moveDraw(e) {
      if (!drawing) return;
      e.preventDefault();
      const pos = getPos(e);
      const level = levelSelect.value;
      let base = 0.03;
      if (level === "1") base = 0.045; // dicker f√ºr die Kleinen
      else if (level === "2") base = 0.035;
      else base = 0.028; // feiner f√ºr √§ltere Kinder

      ctx.lineWidth = Math.max(canvas.clientWidth * base, 6);
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.strokeStyle = penColor;
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
      lastX = pos.x;
      lastY = pos.y;
    }

    function endDraw(e) {
      if (!drawing) return;
      e.preventDefault();
      drawing = false;
    }

    canvas.addEventListener("mousedown", startDraw);
    canvas.addEventListener("mousemove", moveDraw);
    window.addEventListener("mouseup", endDraw);

    canvas.addEventListener("touchstart", startDraw, { passive: false });
    canvas.addEventListener("touchmove", moveDraw, { passive: false });
    canvas.addEventListener("touchend", endDraw, { passive: false });
    canvas.addEventListener("touchcancel", endDraw, { passive: false });

    // --- Buttons ---
    btnClear.addEventListener("click", () => {
      clearCanvas();
    });

    btnRandom.addEventListener("click", () => {
      const idx = Math.floor(Math.random() * currentList.length);
      charSelect.selectedIndex = idx;
      updateGuideChar();
    });

    btnToggleGuide.addEventListener("click", () => {
      guideVisible = !guideVisible;
      applyGuideVisibility();
      btnToggleGuide.textContent = guideVisible ? "üëÅ Vorlage aus" : "üëÅ Vorlage an";
    });

    modeSelect.addEventListener("change", updateCharList);
    charSelect.addEventListener("change", () => {
      updateGuideChar();
    });
    levelSelect.addEventListener("change", () => {
      updateHints();
    });

    // --- Initialisierung ---
    window.addEventListener("resize", resizeCanvas);
    window.addEventListener("orientationchange", () => setTimeout(resizeCanvas, 150));

    updateCharList();
    setTimeout(() => {
      resizeCanvas();
      updateHints();
    }, 50);
  </script>
</body>
</html>
